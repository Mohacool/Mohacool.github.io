<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" type="text/css" href="css/style.css">
    <link rel="icon" href="data:;base64,=">
    <title>Document</title>

    <style>
        body,
        
        .bg {
          
          background-image: url("background.png");
          height: 300%;
          background-position: center;
          background-repeat: repeat;
          background-size: cover;
          
          
        }
      </style>

    <script
    src="https://code.jquery.com/jquery-3.4.1.min.js"
    integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo="
    crossorigin="anonymous"></script>

    <script src=https://cdnjs.cloudflare.com/ajax/libs/mathjs/3.3.0/math.min.js></script>

    <script type="text/javascript">

        // current Notes
        var curr_notes = ["E","A","D","G","B","E"];
        var curr_notes_num = [0,0,0,0,0,0];

        // Set global variables
        var twelve_notes = ['C','C#','D','D#','E','F','F#','G','G#','A','Bb','B'];
        var open_notes = ["E","B","G","D","A","E"];
        var open_octs = [4,3,3,3,2,2];
        var notePaths = ["/notes/E4.mp3","/notes/B3.mp3","/notes/G3.mp3","/notes/D3.mp3","/notes/A2.mp3","/notes/E2.mp3"];


        // Create 2 empty matrices
        var note_matrix = math.zeros(6,16);
        var oct_matrix = math.zeros(6,16);


        // Plays single note sound, adds the note and note paths (for sound) to lists
        function playNote(string,note_name){

            
            

            if (note_name[1]=="#"){
                note_name = note_name[0] + 's' + note_name[2];
            }
            if (note_name.substring(0,2) == "Bb"){
                console.log(note_name = "As" + note_name[2]);
                note_name = "As" + note_name[2];
            }

            var notePath = "/notes/" + note_name + '.mp3'

            // update NotePaths to later play the whole chord
            notePaths[string-1] = notePath;

            


            $("#myAudio").attr("src",notePath);
            var x = document.getElementById("myAudio"); 
            x.play()
        }


        /* 
        This function deals with all the clicks on the fretboard
        The open strings are 91-96
        The muted strings are 101-106
        The rest of the notes are 1-90
        */ 
        function clicky(note_num){
            console.log("==========================",note_num,"clicked");

            console.log(note_num);
            if (note_num>90){
                var string = note_num - 90;
                console.log("string is now",string);
                var fret = 0;
            }
            else{
                var string = Math.floor(note_num/15) + 1;
                var fret = note_num - (string-1)*15;
            }

            console.log("REAL STRING"+string);
            console.log("REAL FRET" + fret);

            let note_name = note_matrix.get([string-1,fret]); // Fret is not -1 because open string is at pos 0 
            let oct = oct_matrix.get([string-1,fret]);

            let note = note_name + oct;

            // Make the note smaller if its #/b
            if (note_name.length == 2){
                console.log("small");
                $(".note_circle").css({"font-size":"13px"});
            }
            else{
                $(".note_circle").css({"font-size":"14px"});
            }

            let string_name = "string"+ string;
            
            // Change the note name on string
            if (note_name.endsWith('b')){
                note_name = note_name.slice(0,-1)+'\u266D'
            }
            if (note_name.endsWith('#')){
                note_name = note_name.slice(0,-1)+'\u266F'
            }
            $(".note_circle."+string_name).text(note_name);

            // Move the note circle to the correct spot
            let x_pos = 8 + (fret-1)*44.4;
            if (fret==0){
                x_pos = -35;
            }

            // Move note circle
            $(".note_circle."+string_name).css({"left":x_pos+"px"});

            // Show the note
            $(".note_circle."+string_name).css({"visibility":"visible"});

            // Hide the X again
            $(".x."+string_name).css({"opacity":"0"});
            $(".x:hover."+string_name).css({"opacity":"1"});

            if (fret==-0){ fret = 0; }
                
            curr_notes_num[string-1] = fret;

            // Update current notes
            console.log("new",note_name);
            console.log("string now",string);
            curr_notes[string-1] = note_name;

            console.log(curr_notes);
            console.log(curr_notes_num);

            playNote(string,note);
        }


        function muted(string){
            
            let string_name = "string"+string;
            
            $(".note_circle."+string_name).css({"visibility":"hidden"});

            console.log("muted string is",string);

            curr_notes[string-1] = "";
            curr_notes_num[string-1] = -1;

            console.log(curr_notes);
            console.log(curr_notes_num);

            $(".x."+string_name).css({"opacity":"1"});

        }

        function fill_note_matrix(matrix){    
            // Given a note return the next note 
            function nextNotes(notes){
                let next_notes = [];
                for (var i = 0;i < 6; i++){
                    note = notes[i];
                    if (note=="B"){
                        next_notes.push("C");
                    }
                    else{
                        next_notes.push(twelve_notes[twelve_notes.indexOf(note)+1]);
                    }
                }
                return next_notes;
            }

            // Create the note_matrix 

            // Fill the first column of the matrix
            note_matrix.subset(math.index(math.range(0,6),[0]),open_notes);

            var all_notes = [['E','B','G','D','A','E']]; // Alternate tuning change

            // Create an array of all the notes
            for (i=1;i<16;i++){
                all_notes.push(nextNotes(all_notes[i-1]));
            }
            for (i=1;i<16;i++){
                note_matrix.subset(math.index(math.range(0,6),[i]),all_notes[i]);
            }
        }

        function fill_oct_matrix(matrix){  
            // var all_octs = [[4,3,3,3,2,2]]; // Alternate Tuning
            var all_octs = [];
            for (x=0;x<6;x++){
                
                let first_note = open_notes[x][0];
                let dist = 12 - twelve_notes.indexOf(first_note);

                let first_oct = open_octs[x];

                var octs = [];
                for (i=0;i<16;i++){
                    octs.push(first_oct);
                    dist -=1;
                    if(dist==0){
                        first_oct+=1;
                        dist= 12;
                    }


                }
                matrix.subset(math.index([x],math.range(0,16)),[octs]);
                //console.log("this",matrix.subset(math.index([x],math.range(0,15))));
                //console.log("this then",[octs]);

            }
            

        }
        function inRange(x, min, max) {
            return ((x-min)*(x-max) <= 0);
        }

       
        

        $(document).ready(function(){

            let top = $("#fretboard").css('padding-top');
            console.log("--------------"+top);
            


            // Create note and oct matrices
            fill_note_matrix(note_matrix);
            fill_oct_matrix(oct_matrix);
            
            
            

        });

        
        

    </script>
    
    
    

</head>

    <body>
        
        <div class="bg"></div>
        <div class="header">
            <div class="logo_container">

                <img src="title.png" id="logo_container">
            </div>

        </div>
        

        <audio id="myAudio">
            <source src="" type="audio/mp3">
        </audio>

        <!-- <img src="title.png" id="title"> !-->

        <div id="sidebar">
        

        </div>

        <div id="fretboard">
            

            
            
            <img src="fretboard.PNG" id="black">
            
            <div class="box"></div>
            <div class="box" style="top:-57px"></div>
            <div class="box" style="top:-100px"></div>
            <div class="box" style="top:-143px"></div>
            <div class="box" style="top:-187px"></div>
            <div class="box" style="top:-228px"></div>
            
            
            <div id="nodegrid">
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('1')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('2')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('3')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('4')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('5')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('6')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('7')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('8')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('9')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('10')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('11')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('12')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('13')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('14')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('15')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('16')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('17')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('18')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('19')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('20')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('21')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('22')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('23')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('24')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('25')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('26')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('27')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('28')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('29')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('30')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('31')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('32')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('33')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('34')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('35')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('36')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('37')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('38')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('39')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('40')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('41')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('42')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('43')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('44')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('45')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('46')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('47')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('48')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('49')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('50')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('51')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('52')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('53')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('54')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('55')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('56')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('57')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('58')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('59')"></div>
                <div class='nudge' style='top:-252px;display:inline-block' onclick="clicky('60')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('61')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('62')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('63')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('64')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('65')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('66')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('67')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('68')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('69')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('70')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('71')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('72')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('73')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('74')"></div>
                <div class='nudge' style='top:-251px;display:inline-block' onclick="clicky('75')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('76')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('77')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('78')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('79')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('80')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('81')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('82')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('83')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('84')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('85')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('86')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('87')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('88')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('89')"></div>
                <div class='nudge' style='top:-250px;display:inline-block' onclick="clicky('90')"></div>

            </div>


            <span class="x string1" style="top:-436px" onclick="muted('1')">X</span>
            <span class="x string2" style="top:-436px" onclick="muted('2')">X</span>
            <span class="x string3" style="top:-435px" onclick="muted('3')">X</span>
            <span class="x string4" style="top:-434px" onclick="muted('4')">X</span>
            <span class="x string5" style="top:-433px" onclick="muted('5')">X</span>
            <span class="x string6" style="top:-430px" onclick="muted('6')">X</span>

            <span class="open string1" onclick="clicky('91')"></span>
            <span class="open string2" onclick="clicky('92')"></span>
            <span class="open string3" onclick="clicky('93')"></span>
            <span class="open string4" onclick="clicky('94')"></span>
            <span class="open string5" onclick="clicky('95')"></span>
            <span class="open string6" onclick="clicky('96')"></span>


            <span class="note_circle string1">E</span>
            <span class="note_circle string2">A</span>
            <span class="note_circle string3">D</span>
            <span class="note_circle string4">G</span>
            <span class="note_circle string5">B</span>
            <span class="note_circle string6">E</span>

            

            
            

           
            
            
            
            
            
            
        </div>
        
    </body>


</html>
